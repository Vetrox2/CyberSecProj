<div class="admin-panel">
  <div class="toolbar">
    <button (click)="openCreate()">Dodaj nowego użytkownika</button>
    <button (click)="openLogs()">Zobacz logi</button>
  </div>

  <!-- Settings Section -->
  <div class="settings-section">
    <h2>Ustawienia aplikacji</h2>

    <div class="setting-row">
      <label>Czas sesji (minuty):</label>
      <div class="counter">
        <button
          (click)="decrementSessionTimeout()"
          [disabled]="sessionTimeout() <= 1"
        >
          -
        </button>
        <span class="counter-value">{{ sessionTimeout() }}</span>
        <button (click)="incrementSessionTimeout()">+</button>
      </div>
    </div>

    <div class="setting-row">
      <label>Max błędnych logowań:</label>
      <div class="counter">
        <button
          (click)="decrementMaxFailedAttempts()"
          [disabled]="maxFailedAttempts() <= 1"
        >
          -
        </button>
        <span class="counter-value">{{ maxFailedAttempts() }}</span>
        <button (click)="incrementMaxFailedAttempts()">+</button>
      </div>
    </div>

    <div class="setting-row">
      <label>Czas blokady (minuty):</label>
      <div class="counter">
        <button
          (click)="decrementLockoutDuration()"
          [disabled]="lockoutDuration() <= 1"
        >
          -
        </button>
        <span class="counter-value">{{ lockoutDuration() }}</span>
        <button (click)="incrementLockoutDuration()">+</button>
      </div>
    </div>

    <div class="settings-actions">
      <button
        class="save-button"
        (click)="saveSettings()"
        [disabled]="!settingsChanged()"
        [class.active]="settingsChanged()"
      >
        {{ settingsChanged() ? "Zapisz zmiany" : "Brak zmian" }}
      </button>
    </div>
  </div>

  <div *ngIf="loading()">Ładowanie...</div>

  <table class="users-table" *ngIf="users().length > 0">
    <thead>
      <tr>
        <th>Login</th>
        <th>Imię</th>
        <th>Rola</th>
        <th>Zablokowany</th>
        <th>Wym. zasady</th>
        <th>Pass valid to</th>
        <th>Akcje</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let u of users()">
        <td>{{ u.login }}</td>
        <td>{{ u.name }}</td>
        <td>{{ getRoleName(u.roleId) }}</td>
        <td>
          <button (click)="toggleBlock(u)">
            {{ u.isBlocked ? "Odblokuj" : "Zablokuj" }}
          </button>
        </td>
        <td>
          <button (click)="toggleRequireRules(u)">
            {{ u.requirePasswordRules ? "Wyłącz" : "Włącz" }}
          </button>
        </td>
        <td>
          <input
            type="date"
            [value]="
              u.passwordValidTo ? (u.passwordValidTo | date : 'yyyy-MM-dd') : ''
            "
            (change)="setPasswordValidTo(u, $any($event.target).value)"
          />
        </td>
        <td class="actions">
          <button (click)="openEdit(u)">Edytuj</button>
          <button (click)="openSetPassword(u.id)">Ustaw hasło</button>
          <button (click)="generateOtp(u.login)">Generuj OTP</button>
          <button (click)="generateUnlockKey(u.id, u.login)">
            Generuj klucz
          </button>
          <button (click)="deleteUser(u)">Usuń</button>
          <button (click)="openLogs(u.id)">Logi</button>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="users().length === 0 && !loading()">Brak użytkowników</div>
</div>
